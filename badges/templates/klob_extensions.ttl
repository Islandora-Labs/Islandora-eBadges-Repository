@prefix acl: <http://www.w3.org/ns/auth/acl#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix klob: <http://knowledgelinks.io/ns/openbadges/> .
@prefix klff: <http://knowledgelinks.io/ns/formfields/> .
@prefix klr: <http://knowledgelinks.io/ns/resources/> .
@prefix kls: <http://knowledgelinks.io/ns/security/> .
@prefix obi: <https://w3id.org/openbadges#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix schema: <https://schema.org/> .

#------- Explanation of fields and uses -------------------------------------------------
#    klob:jsonObjName     "literal"       -The name to be used in the json return for the object portion i.e. {"jsonObjName": .... }
#    klob:useFor          obi:ClassName   -The classes that use that property  
#    klob:propertyField   <propertyUri>   -Specifies which property to use in the Resource graph (optional)
#    klob:defaultVal      "literal"       -will return the value if the specified klob:propertyField does not exist in the resource (OPTIONAL)
#    klob:jsonValFormat   "literal"       -The type of lookup to be used. Options are:
#                                              "objectValue"        -> This will return the value of the specified property or a default value
#                                              "lookup"             -> Will use the resources object to lookup the value that is specified 
#                                                                      in the klob:lookupReturnField
#                                              "subjectCalc"        -> will calculate a return value based on the resource URI
#                                                                      only available parseType is "afterLastSlash" 
#                                                                      need to use klob:parseType and klob:unionUrl(optional) with this action
#                                              "urlSub"             -> will substitue a value as a url with 
#                                                                           - klob:url             specifies the main url
#																															      				-	klob:urlendfld       specifies with resource field to append to the url
#																							 "lookupUrlSub"       -> functions as urlSub but will lookup a property of the specified URI 
#																							                              - klob:propertyField   must be specified
#																							 "lookupProperties"   -> return a json object of the the defined properties.
#																							                         add a klob:propertyField with a blank node for each desired property to return
#																							                         example:   klob:lookupReturnField [
#																							                                                   		       klob:jsonObjName "type";
#																							                                                   		       klob:jsonValFormat "objectValue" ;
#																							                                                   		       klob:defaultVal "hosted"
#																							                                                   		     ] ;
#																							 "multiValArray"      -> will return an array of all values list with with property field specified in
#																							                         klob:propertyField   Example: klob:propertyField obi:tags
#																							                         resource Data = <> obi:tags "home"
#																							                                         <> obi:tags "house"
#																							                                         <> obi:tags "farm"
#																							                         returns -> ["home","house","farm"]
#    klob:parseType  "afterLastSlash"      -is the only available option: used with "subjectCalc"
#    klob:unionUrl   "literal"             -string to be prepended to the the afterLastSlash return of the subject URI
#    klob:url        "literal"             -tring to prepend in a "urlSub" or "lookupUrlSub" call
#	   klob:urlendfld  <propertyUri>         -the fiel value to append to a "urlSub" or "lookupUrlSub" call
#    klob:lookupReturnField   <propUri>    -used with "lookup" call to specify which property field value wil be returned
#    klff:fieldType  "literal"             -string representing the type field to be used in a form. Options are:
#                                              "text", "textbox", "date", "datetime", "select", "password", "email"
#    klff:fieldDefault                     - Default form field value
#    klff:fieldOptions  blanknode          - blank node contains instructions on how to get list of options
#    klff:fieldSecurity blanknode          - blank node contains instructions on who is allowed access to the field/property
#    klff:formLabelName "literal"          - name of the field to be used in the form.
#    klff:formFieldName "literal"         - name of that should be used in html name/id attribute

obi:BadgeClass a rdf:Class;
	rdfs:domain	obi:Resource;	
	rdfs:range	rdfs:Literal;	
	rdfs:comment "Class for open badges.";	
	rdfs:label "Open Badge Class";
	klob:jsonObjName "BadgeClass" .
	
obi:Assertion a rdf:Class;  
	rdfs:domain	obi:Resource;	
	rdfs:range	rdfs:Literal;	
	rdfs:comment "Assertion for open badges.";	
	rdfs:label "Open Badge Assertion";
	klob:jsonObjName "Assertion" .
	
obi:context a rdf:Property;
	rdfs:domain obi:Resource;
	rdfs:range rdfs:literal;
	rdfs:comment "Name of the open badge instance.";	
	klob:jsonObjName "@context";
	klob:jsonValFormat "objectValue" ;
	klob:defaultVal "https://w3id.org/openbadges/v1" ;
	klob:propertyField obi:context ;
	klob:useFor obi:BadgeClass ;
	klob:useFor obi:Assertion .

obi:assertionid a rdf:Property;
	rdfs:domain obi:Resource;
	rdfs:range rdfs:literal;
	rdfs:comment "Uuid of the open badge assertion.";	
	klob:jsonObjName "id";
	klob:jsonValFormat "subjectCalc" ;
	klob:parseType "afterLastSlash" ;
	klob:unionUrl "{{ base_url }}/badges/Assertion/";
	klob:useFor obi:Assertion .

obi:assertionImage a rdf:Property;
	rdfs:domain obi:Resource;
	rdfs:range rdfs:literal;
	rdfs:comment "Image URL of the open badge assertion.";	
	klob:jsonObjName "image";
	klob:jsonValFormat "subjectCalc" ;
	klob:parseType "afterLastSlash" ;
	klob:unionUrl "{{ base_url }}/badges/AssertionImage/";
	klob:useFor obi:Assertion .
	
obi:uid a rdf:Property;
	rdfs:domain obi:Resource;
	rdfs:range rdfs:literal;
	rdfs:comment "uid of the open badge assertion.";	
	klob:jsonObjName "uid";
	klob:jsonValFormat "subjectCalc" ;
	klob:parseType "afterLastSlash" ;
	klob:useFor obi:Assertion .
	
obi:hasBadge a rdf:Property;
	rdfs:domain obi:Resource;
	rdfs:range rdfs:literal;
	rdfs:comment "Badge used for the badge assertion.";	
	klob:jsonObjName "badge";
	klob:jsonValFormat "lookupUrlSub" ;
	klob:propertyField obi:hasBadge ;
	klob:url "{{ base_url }}/badges/BadgeClass/";
	klob:urlendfld schema:alternativeName;
	klob:useFor obi:Assertion .

obi:issuedOn a rdf:Property;
	rdfs:domain obi:Resource;
	rdfs:range rdfs:literal;
	rdfs:comment "Timestamp when badge was issued.";	
	klob:jsonObjName "issuedOn";
	klob:jsonValFormat "objectValue" ;
	klob:propertyField obi:issuedOn ;
	klob:useFor obi:Assertion .

obi:expires a rdf:Property;
	rdfs:domain obi:Resource;
	rdfs:range rdfs:literal;
	rdfs:comment "Timestamp when badge expires.";	
	klob:jsonObjName "expires";
	klob:jsonValFormat "objectValue" ;
	klob:propertyField obi:expires ;
	klob:useFor obi:Assertion .
	
obi:recipient a rdf:Property;
	rdfs:domain obi:Recipient;
	rdfs:range rdfs:literal;
	rdfs:comment "Recipient of a Badge.";	
	klob:jsonObjName "recipient";
	klob:jsonValFormat "lookupProperties" ;
	klob:lookupReturnField [
		klob:jsonObjName "type";
		klob:jsonValFormat "objectValue" ;
		klob:defaultVal "email";
		klob:propertyField obi:assertionType
	] ;
	klob:lookupReturnField [
		klob:jsonObjName "hashed";
		klob:jsonValFormat "objectValue" ;
		klob:defaultVal true ;
		klob:propertyField obi:hash
	] ;
	klob:lookupReturnField [
		klob:jsonObjName "salt";
		klob:jsonValFormat "objectValue" ;
		klob:defaultVal "secretKey";
		klob:propertyField obi:secretKey
	] ;
	klob:lookupReturnField [
		klob:jsonObjName "identity";
		klob:jsonValFormat "objectValue" ;
		klob:propertyField obi:identity
	] ;
	klob:useFor obi:Assertion .

obi:verify a rdf:Property;
	rdfs:domain obi:Recipient;
	rdfs:range rdfs:literal;
	rdfs:comment "Instructions for third parties to verify this assertion.";	
	klob:jsonObjName "verify";
	klob:jsonValFormat "lookupProperties" ;
	klob:lookupReturnField [
		klob:jsonObjName "type";
		klob:jsonValFormat "objectValue" ;
		klob:defaultVal "hosted"
	] ;
	klob:lookupReturnField [
		klob:jsonObjName "url";
		klob:jsonValFormat "subjectCalc" ;
		klob:parseType "afterLastSlash" ;
		klob:unionUrl "{{ base_url }}/badges/Assertion/"
	] ;
	klob:useFor obi:Assertion .
	
obi:name a rdf:Property;	
	rdfs:domain	obi:Resource;	
	rdfs:range	rdfs:Literal;	
	rdfs:comment "Name of the open badge instance.";	
	klob:jsonObjName "name";
	klob:jsonValFormat "objectValue";
	klob:useFor obi:BadgeClass .

obi:description a rdf:Property;	
	rdfs:domain	obi:Resource;	
	rdfs:range	rdfs:Literal;	
	rdfs:comment "Description of the open badge instance.";	
	klob:jsonObjName "description";
	klob:jsonValFormat "objectValue";
	klob:useFor obi:BadgeClass .

obi:issuer a rdf:Property;	
	rdfs:domain	obi:Resource;	
	rdfs:range	obi:Issuer;	
	rdfs:comment "Issuer of the open badge instance.";	
	klob:jsonObjName "issuer";
	klob:jsonValFormat "lookup";
	klob:lookupReturnField obi:url;
	klob:useFor obi:BadgeClass .

obi:type a rdf:Property;	
	rdfs:domain	obi:Resource;	
	rdfs:range	obi:Resource;	
	rdfs:comment "Type of item";	
	klob:jsonObjName "type";
	klob:jsonValFormat "lookup";
	klob:lookupReturnField klob:jsonObjName;
	klob:useFor obi:BadgeClass ;
	klob:useFor obi:Assertion .	

obi:image a rdf:Property;	
	rdfs:domain	obi:Resource;	
	rdfs:range	rdfs:literal;	
	rdfs:comment "Issuer of the open badge instance.";	
	klob:jsonObjName "image";
	klob:jsonValFormat "urlSub";
	klob:url "{{ base_url }}/badges/BadgeImage/";
	klob:urlendfld schema:alternativeName;
	klob:useFor obi:BadgeClass .

obi:criteria a rdf:Property;	
	rdfs:domain	obi:Resource;	
	rdfs:range	rdfs:literal;	
	rdfs:comment "Issuer of the open badge instance.";	
	klob:jsonObjName "criteria";
	klob:jsonValFormat "urlSub";
	klob:url "{{ base_url }}/badges/BadgeCriteria/";
	klob:urlendfld schema:alternativeName;
	klob:useFor obi:BadgeClass .	
	
obi:id a rdf:Property;	
	rdfs:domain	obi:Resource;	
	rdfs:range	rdfs:literal;	
	rdfs:comment "Issuer of the open badge instance.";	
	klob:jsonObjName "id";
	klob:jsonValFormat "urlSub";
	klob:url "{{ base_url }}/badges/BadgeClass/";
	klob:urlendfld schema:alternativeName;
	klob:useFor obi:BadgeClass .

obi:tags a rdf:Property;	
	rdfs:domain	obi:Resource;	
	rdfs:range	rdfs:literal;	
	rdfs:comment "Tags for the badges.";	
	klob:jsonObjName "tags";
	klob:jsonValFormat "multiValArray";
	klob:useFor obi:BadgeClass .	

obi:userName a rdf:Property;	
	rdfs:domain	obi:Resource;	
	rdfs:range	rdfs:literal;	
	rdfs:comment "Open Badge username.";	
	klob:jsonObjName "username";
	klob:jsonValFormat "objectValue";
	klob:useFor obi:UserClass;               
	klff:fieldType "text";
	klff:fieldValidation "uniqueValue";   
        # foaf:Agent required by all servers to represent public access       
        acl:accessTo [
                        acl:mode acl:Read;
                        acl:agentClass foaf:Agent
                ];
        acl:accessToClass [
                        acl:mode acl:Append;
                        acl:agentClass klff:self;
                        acl:agentClass klff:Admin
        ];               
        acl:accessToClass [
                        acl:mode acl:Write;
                        acl:mode acl:Control;
                        acl:agentClass klff:Admin
        ]; 
	klff:fieldSecurity [
			kls:userGroup "self";
			kls:permissions "read, write"
		];
	klff:fieldSecurity [
			kls:userGroup "none";
			kls:permissions "read"
		];
	klff:fieldSecurity [
			kls:userGroup "admin";
			kls:permissions "read, write, delete"
		];          
	klff:formLabelName "Username";
	klff:formFieldOrder 1; 
	klff:formLayoutRow 1;          
	klff:formFieldName "username" .

obi:salt a rdf:Property;	
	rdfs:domain	obi:PasswordClass;	
	rdfs:range	rdfs:literal;	
	rdfs:comment "Salt used for hash.";	
	klob:jsonObjName "salt";
	klob:jsonValFormat "objectValue";
	klob:useFor obi:UserClass;               
	klff:fieldType "serverOnly";
	klff:fieldProccessing "salt";
	klff:fieldValidation "uniqueValue";         
	klff:fieldSecurity [
			kls:userGroup "self";
			kls:permissions "read, write"
		];
	klff:fieldSecurity [
			kls:userGroup "none";
			kls:permissions "none"
		];
	klff:fieldSecurity [
			kls:userGroup "admin";
			kls:permissions "read"
		];
	klff:formFieldName "salt".
	
obi:password a rdf:Property;	
	rdfs:domain	obi:PasswordClass;	
	rdfs:range	rdfs:literal;	
	rdfs:comment "User's account password.";	
	klob:jsonObjName "username";
	klob:jsonValFormat "objectValue";
	klob:useFor obi:UserClass;               
	klff:fieldType "password";
	klff:fieldValidation "passwordValidation"; 
	klff:fieldSaveType "secureHash";         
	klff:fieldSecurity [
			kls:userGroup "self";
			kls:permissions "read, write"
		];
	klff:fieldSecurity [
			kls:userGroup "none";
			kls:permissions "read"
		];
	klff:fieldSecurity [
			kls:userGroup "admin";
			kls:permissions "read, write, delete"
		];          
	klff:formLabelName "Password";
	klff:formFieldOrder 1; 
	klff:formLayoutRow 1;          
	klff:formFieldName "password" .

obi:hasPassword a rdf:Property;	
	rdfs:domain	obi:Resource;	
	rdfs:range	obi:PasswordClass;	
	rdfs:comment "User's account password object.";	
	klob:jsonObjName "Password";
	klob:jsonValFormat "lookupProperties";
	klob:lookupReturnField [
		klob:jsonObjName "salt";
		klob:jsonValFormat "objectValue" ;
		klob:propertyField obi:salt
	] ;
	klob:lookupReturnField [
		klob:jsonObjName "type";
		klob:jsonValFormat "objectValue" ;
		klob:propertyField obi:password
	] ;
	klob:useFor obi:UserClass;               
	klff:fieldType "objectStore";
	klff:objectStore obi:PasswordClass;	        
	klff:fieldSecurity [
			kls:userGroup "self";
			kls:permissions "read, write"
		];
	klff:fieldSecurity [
			kls:userGroup "none";
			kls:permissions "read"
		];
	klff:fieldSecurity [
			kls:userGroup "admin";
			kls:permissions "read, write, delete"
		];                   
	klff:formFieldName "PasswordClass" .

	
schema:givenName a rdf:Property;	
	rdfs:domain	obi:Person;	
	rdfs:range	rdfs:literal;	
	rdfs:comment "First name or given name for an individual.";	
	klob:jsonObjName "givenname";
	klob:jsonValFormat "objectValue";
	klob:useFor obi:UserClass;
	klob:useFor obi:Person;               
	klff:fieldType "text";
	klff:fieldValidation "none";          
	klff:fieldSecurity [
			kls:userGroup kls:Self;
			kls:permissions "read,write"
		];
	klff:fieldSecurity [
			kls:userGroup kls:Public;
			kls:permissions "read"
		];
	klff:fieldSecurity [
			kls:userGroup kls:Admin;
			kls:permissions "read,write,delete"
		];          
	klff:formLabelName "Given name"; 
	klff:formFieldOrder 2;
	klff:formLayoutRow 2;          
	klff:formFieldName "givenName" .
	
schema:familyName a rdf:Property;	
	rdfs:domain	obi:Person;	
	rdfs:range	rdfs:literal;	
	rdfs:comment "Last name or family name for an individual.";	
	klob:jsonObjName "familyname";
	klob:jsonValFormat "objectValue";
	klob:useFor obi:UserClass;
	klob:useFor obi:Person;               
	klff:fieldType "text";
	klff:fieldValidation "none";          
	klff:fieldSecurity [
			kls:userGroup kls:Self;
			kls:permissions "read,write"
		];
	klff:fieldSecurity [
			kls:userGroup kls:Public;
			kls:permissions "read"
		];
	klff:fieldSecurity [
			kls:userGroup kls:Admin;
			kls:permissions "read,write,delete"
		];          
	klff:formLabelName "Family name";
	klff:formFieldOrder 3;  
	klff:formLayoutRow 2;         
	klff:formFieldName "familyName" .
	
schema:email a rdf:Property;	
	rdfs:domain	obi:Person;	
	rdfs:range	rdfs:literal;	
	rdfs:comment "email address.";	
	klob:jsonObjName "email";
	klob:jsonValFormat "objectValue";
	klob:useFor obi:UserClass;
	klob:useFor obi:Person;               
	klff:fieldType "email";
	klff:fieldValidation "email";          
	klff:fieldSecurity [
			kls:userGroup kls:Self;
			kls:permissions "read,write"
		];
	klff:fieldSecurity [
			kls:userGroup kls:Public;
			kls:permissions "read"
		];
	klff:fieldSecurity [
			kls:userGroup kls:Admin;
			kls:permissions "read,write,delete"
		];          
	klff:formLabelName "Email"; 
	klff:formFieldOrder 4; 
	klff:formLayoutRow 3;        
	klff:formFieldName "email" .
	
klff:forms a rdf:Property.

klff:fieldType a rdf:Property;
	rdfs:subPropertyOf klff:forms;
	rdfs:domain	rdf:Property;	
	rdfs:range	klff:FieldClass.
		
klff:fieldValidation a rdf:Property;          
	rdfs:subPropertyOf klff:forms.

klff:fieldSecurity a rdf:Property;
	rdfs:subPropertyOf klff:forms.

kls:userGroup a rdf:Property;
	rdfs:subPropertyOf klff:fieldSecurity.

kls:permissions a rdf:Property;
	rdfs:subPropertyOf klff:fieldSecurity.

klff:formLabelName a rdf:Property;         
	rdfs:subPropertyOf klff:forms.
	
klff:formFieldName a rdf:Property;
	rdfs:subPropertyOf klff:forms.

klff:formLayoutRow a rdf:Property;
  rdfs:subPropertyOf klff:forms.
  
klff:fieldSaveType a rdf:Property;
  rdfs:subPropertyOf klff:forms.
  
klff:fieldProccessing a rdf:Property;
  rdfs:subPropertyOf klff:forms.

klff:fieldValidation a rdf:Property;
  rdfs:subPropertyOf klff:forms.
  
klr:UserGroup a rdf:Class;
	rdfs:label "User group";
	rdfs:comment "a group of users".
	
kls:SysAdmin a klr:UserGroup;
	rdfs:label "SysAdmin-SG";
	rdfs:comment "The application system admin security group";
	kls:basePermissions "full";
	kls:specifiedPermissions "override".

kls:Admin a klr:UserGroup;
	rdfs:label "Admin-SG";
	rdfs:comment "The application admin security group for managing content";
	kls:basePermissions "full";
	kls:specifiedPermissions "adhere".
	
kls:Self a klr:UserGroup;
	rdfs:label "Self-SG";
	rdfs:comment "The security group pertaining to logged in user level permissions";
	kls:basePermissions "read";
	kls:specifiedPermissions "adhere".

kls:Public a klr:UserGroup;
	rdfs:label "Public-SG";
	rdfs:comment "The security group for public access";
	kls:basePermissions "none";
	kls:specifiedPermissions "adhere".
